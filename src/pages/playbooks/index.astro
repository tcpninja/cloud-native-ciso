---
import { getCollection } from 'astro:content';
import { playbookSetting } from '../../data/config'; // You may need to create this file
import PaginatedPlaybookLayout from '../../components/playbooks/PaginatedPlaybookLayout.astro';

export const prerender = true;

const currentPage = parseInt(Astro.url.searchParams.get('page') || '1');
const allPlaybooks = await getCollection('playbooks');

const filteredPlaybooks = allPlaybooks.filter((p) => {
  return import.meta.env.DEV || p.data.publish !== false;
});

const sortedPlaybooks = filteredPlaybooks.sort((a, b) => a.data.order - b.data.order);

const totalPlaybooks = sortedPlaybooks.length;
const totalPages = Math.ceil(totalPlaybooks / playbookSetting.postsPerPage);
const start = (currentPage - 1) * playbookSetting.postsPerPage;
const end = start + playbookSetting.postsPerPage;
const paginatedPlaybooks = sortedPlaybooks.slice(start, end);
---

<PaginatedPlaybookLayout
  playbooks={paginatedPlaybooks}
  currentPage={currentPage}
  totalPages={totalPages}
  baseUrl="/playbooks"
  title="Cloud Native Playbooks"
  subtitle="Actionable strategies for modern cloud security"
/>
