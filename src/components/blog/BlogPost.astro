---
import { categories } from '../../data/categories';
import HashtagCategory from '../ui/HashtagCategory.astro';
import Date from '../ui/Date.astro';
import { Image } from 'astro:assets';

interface Props {
    title: string;
    excerpt: string;
    featuredImage: any;// Changed to accept ImageMetadata from content collections
    publishDate: Date;
    categories: string[];
    slug?: string;
    index: number;
}

const { title, excerpt, featuredImage, publishDate, categories: postCategories, slug, index } = Astro.props;

// Validate categories against the valid categories
const validCategories = postCategories.filter((categoryName: string) =>
    categories.some((category) => category.name === categoryName),
);
---

<a
    href={`/blog/${slug}`}
    class="group flex flex-col h-full overflow-hidden rounded-2xl border border-[var(--color-border)] bg-[var(--color-surface)] shadow-md hover:shadow-lg transition-all duration-300"
    data-aos="fade-up"
    data-aos-delay={index * 100}
>
    <div
        class="relative aspect-[16/9] overflow-hidden border-b border-[var(--color-border)] group-hover:border-primary transition-colors duration-300"
    >
        {
            featuredImage && (
                <Image
                    src={featuredImage}
                    alt=""
                    width={600}
                    height={338}
                    class="object-cover w-full h-full grayscale group-hover:grayscale-0 group-hover:scale-105 transition-all duration-300"
                />
            )
        }
        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/10 opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
    </div>

    <div class="p-5 flex flex-col flex-grow relative">
        <div class="text-sm text-muted-foreground mb-2 group-hover:text-primary/80 transition-colors duration-300">
            <Date date={publishDate} />
        </div>

        <h2 class="text-xl font-semibold text-[var(--color-headline)] group-hover:text-primary transition-colors duration-300">
            {title}
        </h2>

        <p class="mt-2 mb-12 text-sm text-[var(--color-body-light)] leading-relaxed line-clamp-4 group-hover:text-[var(--color-body)] transition-colors duration-300">
            {excerpt}
        </p>

        {/* Categories as hashtags at the bottom */}
        <div class="absolute bottom-4 left-5 flex flex-wrap gap-1">
            {
                validCategories.map((categoryName) => (
                    <div class="category-tag">
                        <HashtagCategory category={categoryName} />
                    </div>
                ))
            }
        </div>
    </div>
</a>
<script>
    document
        .querySelectorAll('div.category-tag')
        .forEach((e) => e.addEventListener('click', (event) => event.stopPropagation()));
</script>
